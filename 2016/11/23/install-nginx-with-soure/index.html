<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><title>nginx源码安装 | xuxping</title><link rel="stylesheet" type="text/css" href="../../../../css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/latest/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/grids-responsive-min.min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/latest/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="../../../../favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="../../../../favicon.ico"><link rel="apple-touch-icon" href="../../../../apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="../../../../apple-touch-icon.png"><script type="text/javascript" src="//lib.baomitu.com/clipboard.js/latest/clipboard.min.js"></script><script type="text/javascript" src="//lib.baomitu.com/toastr.js/latest/toastr.min.js"></script><link rel="stylesheet" href="//lib.baomitu.com/toastr.js/latest/toastr.min.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">nginx源码安装</h1><a id="logo" href="../../../../.">xuxping</a><p class="description">一点一滴积累</p></div><div id="nav-menu"><a class="current" href="../../../../."><i class="fa fa-home"> 首页</i></a><a href="../../../../archives/"><i class="fa fa-archive"> 归档</i></a><a href="../../../../about/"><i class="fa fa-user"> 关于</i></a><a href="../../../../atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">nginx源码安装</h1><div class="post-meta">2016-11-23<span> | </span><span class="category"><a href="../../../../categories/Nginx/">Nginx</a></span></div><div class="post-content"><p>以前装nginx都是用yum命令直接安装，一步到位。现在借着服务器迁移的机会，来次源码安装的实践。</p>
<h2 id="安装版本选择"><a href="#安装版本选择" class="headerlink" title="安装版本选择"></a>安装版本选择</h2><p>Nginx官网提供了三个类型的版本  </p>
<ul>
<li>Mainline version：Mainline 是 Nginx 目前主力在做的版本，可以说是开发版  </li>
<li>Stable version：最新稳定版，生产环境上建议使用的版本  </li>
<li>Legacy versions：遗留的老版本的稳定版</li>
</ul>
<p>我选择了nginx-1.10.2的稳定版本，下载到&#x2F;usr&#x2F;local&#x2F;src的目录下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># wget http://nginx.org//download/nginx-1.10.2.tar.gz  </span><br><span class="line">//解压</span><br><span class="line"># tar zxvf nginx-1.10.2.tar.gz</span><br></pre></td></tr></table></figure>

<h2 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h2><ol>
<li><p>服务器环境</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># cat /etc/redhat-release </span><br><span class="line">CentOS Linux release 7.2.1511 (Core)</span><br></pre></td></tr></table></figure>
</li>
<li><p>依赖包安装</p>
<p> nginx在编译和安装的时候需要一些工具和第三包模块，因此先下载安装</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># yum -y install gcc gcc-c++ make libtool zlib zlib-devel openssl openssl-devel pcre pcre-devel</span><br></pre></td></tr></table></figure>
</li>
<li><p>编译配置项</p>
</li>
</ol>
<p>nginx大部分常用模块，编译时.&#x2F;configure –help以–without开头的都默认安装。</p>
<ul>
<li>–prefix&#x3D;PATH ： 指定nginx的安装目录。默认 &#x2F;usr&#x2F;local&#x2F;nginx  </li>
<li>–conf-path&#x3D;PATH ： 设置nginx.conf配置文件的路径。nginx允许使用不同的配置文件启动，通过命令行中的-c选项。默认为prefix&#x2F;conf&#x2F;nginx.conf  </li>
<li>–user&#x3D;name： 设置nginx工作进程的用户。安装完成后，可以随时在nginx.conf配置文件更改user指令。默认的用户名是nobody。–group&#x3D;name类似  </li>
<li>–with-pcre ： 设置PCRE库的源码路径，如果已通过yum方式安装，使用–with-pcre自动找到库文件。使用–with-pcre&#x3D;PATH时，需要从PCRE网站下载pcre库的源码（版本4.4 - 8.30）并解压，剩下的就交给Nginx的.&#x2F;configure和make来完成。perl正则表达式使用在location指令和 ngx_http_rewrite_module模块中。  </li>
<li>–with-zlib&#x3D;PATH ： 指定 zlib（版本1.1.3 - 1.2.5）的源码解压目录。在默认就启用的网络传输压缩模块ngx_http_gzip_module时需要使用zlib 。  </li>
<li>–with-http_ssl_module ： 使用https协议模块。默认情况下，该模块没有被构建。前提是openssl与openssl-devel已安装  </li>
<li>–with-http_stub_status_module ： 用来监控 Nginx 的当前状态  </li>
<li>–with-http_realip_module ： 通过这个模块允许我们改变客户端请求头中客户端IP地址值(例如X-Real-IP 或 X-Forwarded-For)，意义在于能够使得后台服务器记录原始客户端的IP地址  </li>
<li>–add-module&#x3D;PATH ： 添加第三方外部模块，如nginx-sticky-module-ng或缓存模块。每次添加新的模块都要重新编译（Tengine可以在新加入module时无需重新编译）</li>
</ul>
<p>第一次尝试在服务器上编译，就简单的安装配置  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">./configure </span><br><span class="line">		--user=nginx\</span><br><span class="line">		--group=nginx\</span><br><span class="line">		--with-http_ssl_module\</span><br><span class="line">		--with-http_gzip_static_module\</span><br><span class="line">		--with-http_realip_module\</span><br><span class="line">		--with-http_stub_status_module </span><br></pre></td></tr></table></figure>

<p>安装和编译，安装成功的标准就是不报错</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>

<p>完成之后，启动nginx服务器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./usr/local/nginx/sbin/nginx</span><br></pre></td></tr></table></figure>

<p>至此nginx安装完毕。下面进行一下优化阶段</p>
<h2 id="nginx设置"><a href="#nginx设置" class="headerlink" title="nginx设置"></a>nginx设置</h2><ol>
<li>设置成系统服务，不用每次都使用<code>./usr/local/nginx/sbin/nginx</code> ,来进行操作  <blockquote>
<p>服务有系统（system）和用户（user）之分。如果需要开机没有登录情况下就能运行的程序，存在于系统服务（system）里，即：<code>/lib/systemed/system</code><br>反之，用户登录后才能运行的程序，存在于用户服务（user)里:<code>/lib/systemd/user</code><br>并且服务都以.service结尾</p>
</blockquote>
<p> 因此，在<code>/lib/systemed/system</code>下建立一个nginx.service的文件,添加</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=nginx.service</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">ExecStart=/usr/local/nginx/sbin/nginx</span><br><span class="line">ExecReload=/usr/local/nginx/sbin/nginx -s reload</span><br><span class="line">ExecStop=/usr/local/nginx/sbin/nginx -s stop</span><br><span class="line">PrivateTmp=true</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target </span><br></pre></td></tr></table></figure>
<p> 然后将文件的权限修改为754，只有root用户才能修改。</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 754 nginx.service</span><br></pre></td></tr></table></figure>
<p> 将nginx设置为系统服务，并开机启动</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable nginx.service</span><br></pre></td></tr></table></figure>
<p> 当然也可以使用systemctl来管理nginx的启动和关闭了</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">启动：systemctl start nginx.service</span><br><span class="line">关闭：systemctl stop nginx.service</span><br><span class="line">状态：systemctl status nginx.service</span><br></pre></td></tr></table></figure>
<p> 对于喜欢用systemctl的我，感觉就是棒棒的  </p>
<p> 将 nginx 作为系统服务管理,下载 <a target="_blank" rel="noopener" href="http://sean-images.qiniudn.com/nginx">nginx</a> 到&#x2F;etc&#x2F;init.d&#x2F;，修改里面的路径然后赋予可执行权限</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># service nginx &#123;start|stop|status|restart|reload|configtest&#125; </span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="nginx常用命令"><a href="#nginx常用命令" class="headerlink" title="nginx常用命令"></a>nginx常用命令</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">nginx -s reload 重启</span><br><span class="line">nginx -t 测试配置文件</span><br><span class="line">nginx -s stop 关闭nginx</span><br><span class="line">nginx -v nginx 版本</span><br><span class="line">nginx -V nginx编译时的配置项</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="安装时的错误汇总"><a href="#安装时的错误汇总" class="headerlink" title="安装时的错误汇总"></a>安装时的错误汇总</h2><ol>
<li><p>测试nginx的配置文件出现错误</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx: [emerg] getpwnam(&quot;nginx&quot;) failed</span><br></pre></td></tr></table></figure>
<p> 原因是在安装配置时指定了user&#x3D;nginx和group&#x3D;nginx,而现在系统中并没有这个用户组和用户，因此需要先创建对应的组和用户</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">groupadd nginx </span><br><span class="line">useradd -g nginx nginx</span><br></pre></td></tr></table></figure>
<p> 之后测试就通过了。</p>
</li>
</ol>
</div><div class="tags"><a href="../../../../tags/Nginx"><i class="fa fa-tag">Nginx</i></a></div><div class="post-nav"><a class="pre" href="../../../12/11/js%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%8B%B7%E8%B4%9D%E9%97%AE%E9%A2%98/">js对象的拷贝问题</a><a class="next" href="../../10/node-install/">node环境搭建</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://example.com"/></form></div><div class="widget"><div class="author-info"><a class="info-avatar" href="/about/" title="关于"><img src="/img/avatar.png"/></a><p>To be a better man.</p><a class="info-icon" href="https://twitter.com/username" title="Twitter" target="_blank" style="margin-inline:5px"> <i class="fa fa-twitter-square" style="margin-inline:5px"></i></a><a class="info-icon" href="mailto:admin@domain.com" title="Email" target="_blank" style="margin-inline:5px"> <i class="fa fa-envelope-square" style="margin-inline:5px"></i></a><a class="info-icon" href="https://github.com/username" title="Github" target="_blank" style="margin-inline:5px"> <i class="fa fa-github-square" style="margin-inline:5px"></i></a><a class="info-icon" href="/atom.xml" title="RSS" target="_blank" style="margin-inline:5px"> <i class="fa fa-rss-square" style="margin-inline:5px"></i></a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="../../../../categories/AI/">AI</a></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/HBase/">HBase</a></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/Hadoop/">Hadoop</a></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/Hive/">Hive</a></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/Nginx/">Nginx</a></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/Python/">Python</a></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/Spark%E7%B3%BB%E5%88%97/">Spark系列</a></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/ganglia/">ganglia</a></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/project/">project</a></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/tools/">tools</a></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E4%B8%AA%E4%BA%BA%E7%AC%94%E8%AE%B0/">个人笔记</a></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/">人工智能</a></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E5%89%8D%E7%AB%AF/">前端</a></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%AD%A6%E4%B9%A0/">数据分析学习</a></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/">服务器</a></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/">架构设计</a></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E7%A7%9F%E6%88%BF%E7%B3%BB%E7%BB%9F/">租房系统</a></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/%E8%87%AA%E7%84%B6%E8%AF%AD%E8%A8%80%E5%A4%84%E7%90%86/">自然语言处理</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="../../../../tags/HBase/" style="font-size: 15px;">HBase</a> <a href="../../../../tags/Hadoop/" style="font-size: 15px;">Hadoop</a> <a href="../../../../tags/Hive/" style="font-size: 15px;">Hive</a> <a href="../../../../tags/Nginx/" style="font-size: 15px;">Nginx</a> <a href="../../../../tags/Spark/" style="font-size: 15px;">Spark</a> <a href="../../../../tags/tools/" style="font-size: 15px;">tools</a> <a href="../../../../tags/JavaScript/" style="font-size: 15px;">JavaScript</a> <a href="../../../../tags/%E6%9C%8D%E5%8A%A1%E5%99%A8/" style="font-size: 15px;">服务器</a> <a href="../../../../tags/node/" style="font-size: 15px;">node</a> <a href="../../../../tags/tornado/" style="font-size: 15px;">tornado</a> <a href="../../../../tags/mongodb/" style="font-size: 15px;">mongodb</a> <a href="../../../../tags/%E5%A4%96%E5%8C%85/" style="font-size: 15px;">外包</a> <a href="../../../../tags/%E7%88%AC%E8%99%AB/" style="font-size: 15px;">爬虫</a> <a href="../../../../tags/%E7%A7%9F%E6%88%BF%E7%B3%BB%E7%BB%9F/" style="font-size: 15px;">租房系统</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="../../../../2022/09/18/fuse/">fuse</a></li><li class="post-list-item"><a class="post-list-link" href="../../../../2019/12/01/20191201/">文本分类的一些总结</a></li><li class="post-list-item"><a class="post-list-link" href="../../../../2019/09/22/20190922/">第一次跳槽面试总结</a></li><li class="post-list-item"><a class="post-list-link" href="../../../../2019/09/05/20190905/">哲学家都干了些什么</a></li><li class="post-list-item"><a class="post-list-link" href="../../../../2019/09/01/20190901/">我准备离职了</a></li><li class="post-list-item"><a class="post-list-link" href="../../../../2019/08/26/20190826/">做AI，搞NLP，才有qian途</a></li><li class="post-list-item"><a class="post-list-link" href="../../../../2019/06/16/20190616_ASR_from_begin_to_abandoned/">语音识别从入门到放弃</a></li><li class="post-list-item"><a class="post-list-link" href="../../../../2019/04/26/20190426_my-understand-of-AI/">谈谈我对AI的理解</a></li><li class="post-list-item"><a class="post-list-link" href="../../../../2018/08/06/SMP2018%E5%8F%82%E4%BC%9A%E8%A7%81%E9%97%BB/">SMP2018参会见闻</a></li><li class="post-list-item"><a class="post-list-link" href="../../../../2018/07/11/%E8%B8%8F%E5%85%A5%E7%A4%BE%E4%BC%9A%E8%BF%99%E4%B8%80%E5%B9%B4%E2%80%94%E2%80%94%E7%84%A6%E8%99%91%E7%9B%B8%E4%BC%B4/">踏入社会这一年——焦虑相伴</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2022 <a href="../../../../." rel="nofollow">xuxping.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="../../../../js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.js"></script><script type="text/javascript" src="../../../../js/fancybox.js?v=1.0.0"></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.css"><script type="text/javascript" src="../../../../js/copycode.js?v=1.0.0" successtext="复制成功!"></script><link rel="stylesheet" type="text/css" href="../../../../css/copycode.css?v=1.0.0"><script type="text/javascript" src="../../../../js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="../../../../js/smartresize.js?v=1.0.0"></script></div></body></html>